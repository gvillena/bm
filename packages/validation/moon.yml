$schema: 'https://moonrepo.dev/schemas/project.json'

language: 'typescript'
type: 'library'
tags:
  - 'type:library'
  - 'scope:validation'

tasks:
  build:
    command: 'pnpm exec unbuild'
    deps:
      - '^:build'
    inputs:
      - 'src/**/*'
      - 'package.json'
      - 'tsconfig.json'
    outputs:
      - 'dist'
  dev:
    command: 'pnpm exec unbuild'
    args:
      - '--stub'
    options:
      cache: false
  typecheck:
    command: 'pnpm exec tsc'
    args:
      - '-p'
      - 'tsconfig.json'
  clean:
    command: 'pnpm exec rimraf'
    args:
      - 'dist'
    options:
      cache: false
      runInCI: false
  test:
    command: 'pnpm exec vitest'
    args:
      - 'run'
      - '--coverage'
    outputs:
      - 'coverage'
    inputs:
      - 'tests/**/*'
  gen-openapi:
    script: 'pnpm exec ts-node --esm src/openapi/index.ts > openapi.json'
    outputs:
      - 'openapi.json'
  gen-jsonschema:
    script: 'pnpm exec ts-node --esm src/openapi/generators.ts jsonschema > schemas.json'
    outputs:
      - 'schemas.json'
